# راهنمای پیکربندی (Configuration)

ققنوس از فایل‌های **TOML** برای تنظیمات استفاده می‌کند.
هر دو سمت سرور (`phoenix-server`) و کلاینت (`phoenix-client`) به فایل پیکربندی نیاز دارند.

## ۱. پیکربندی سرور (`server.toml`)

این فایل آدرس گوش دادن، امنیت و کلاینت‌های مجاز را تنظیم می‌کند.

```toml
# ==============================
# پیکربندی سرور ققنوس (Phoenix)
# ==============================

# آدرس گوش دادن (Listen Address):
# سرور روی چه پورتی منتظر باشد؟
# ":443" یعنی همه‌چیز (0.0.0.0) روی پورت ۴۴۳.
listen_addr = ":443"

# --- امنیت (Security Settings) ---
[security]

# فعال‌سازی پروتکل SOCKS5:
# کلاینت‌ها بتوانند درخواست SOCKS5 ارسال کنند.
enable_socks5 = true

# فعال‌سازی UDP:
# برای تماس صوتی، بازی و VPN لازم است.
enable_udp = true

# --- رمزنگاری (TLS) ---

# مسیر کلید خصوصی سرور (فرمت PEM).
# با دستور `./phoenix-server -gen-keys` بسازید.
# اگر خالی باشد، سرور در حالت امن‌نبوده (h2c) اجرا می‌شود.
private_key = "server_private.key"

# لیست کلیدهای عمومی کلاینت‌های مجاز (Base64).
# اگر اینجا مقدار داشته باشد، فقط کلاینت‌هایی که نامشان هست می‌توانند وصل شوند (mTLS).
# اگر خالی باشد یا کامنت شود، هر کلاینتی می‌تواند وصل شود (One-Way TLS).
authorized_clients = [
  "کلید_عمومی_کلاینت_۱_...",
  "کلید_عمومی_کلاینت_۲_..."
]
```

## ۲. پیکربندی کلاینت (`client.toml`)

این فایل مشخص می‌کند کلاینت به کجا وصل شود و روی سیستم شما چه پورتی باز کند.

```toml
# ==============================
# پیکربندی کلاینت ققنوس (Phoenix)
# ==============================

# آدرس سرور (Remote Address):
# IP یا دامنه سرور شما.
# مثال: "example.com:443" یا "203.0.113.1:443"
remote_addr = "example.com:443"

# --- احراز هویت (TLS) ---

# کلید عمومی سرور (Base64).
# این برای تایید هویت سرور (Pinning) الزامی است.
# از حمله MITM جلوگیری می‌کند.
server_public_key = "کلید_عمومی_سرور_شما..."

# کلید خصوصی کلاینت (اختیاری - فقط برای mTLS).
# اگر از mTLS استفاده می‌کنید، مسیر کلید خصوصی خود را وارد کنید.
# اگر کامنت شود، کلاینت به صورت ناشناس (One-Way TLS) وصل می‌شود.
# private_key = "client_private.key"

# --- کلاینت‌های ورودی (Inbound Listeners) ---

# پراکسی SOCKS5
[[inbounds]]
protocol = "socks5"
local_addr = "127.0.0.1:1080"
enable_udp = true     # فعال‌سازی UDP Associate
# auth = "user:password" # احراز هویت اختیاری یوزر/پسورد

# پراکسی HTTP (قابلیت آینده)
# [[inbounds]]
# protocol = "http"
# local_addr = "127.0.0.1:8080"
```

## ۳. متغیرهای محیطی (Environment Variables)

در حال حاضر بهتر است از فایل کانفیگ و فلگ `-c` استفاده کنید. پشتیبانی کامل از ENV برای داکر در نسخه‌های بعدی اضافه می‌شود.

## ۴. تولید کلید (Key Generation)

برای مدیریت کلیدها:

**تولید کلید سرور:**
```bash
./phoenix-server -gen-keys
```
فایل `server_private.key` ذخیره می‌شود.
**کلید عمومی (Public Key)** را کپی کرده و در `client.toml` قرار دهید.

**تولید کلید کلاینت (mTLS):**
```bash
./phoenix-client -gen-keys
```
فایل `client_private.key` ذخیره می‌شود.
**کلید عمومی** را کپی کرده و در `server.toml` (بخش `authorized_clients`) قرار دهید.
